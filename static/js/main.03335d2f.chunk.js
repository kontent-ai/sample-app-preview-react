(this["webpackJsonp@kentico/kontent-sample-app-preview-react"]=this["webpackJsonp@kentico/kontent-sample-app-preview-react"]||[]).push([[0],{29:function(e){e.exports=JSON.parse('{"name":"@kentico/kontent-sample-app-preview-react","version":"0.2.0","private":true,"homepage":"https://kentico.github.io/kontent-sample-app-preview-react/","dependencies":{"@kentico/kontent-delivery":"^11.7.0","@types/auth0-js":"^9.10.2","@types/classnames":"^2.2.8","@types/jest":"^24.0.13","@types/node":"^12.0.2","@types/react":"^16.8.17","@types/react-dom":"^16.8.4","@types/react-router-dom":"^4.3.3","auth0-js":"^9.10.2","classnames":"^2.2.6","path-to-regexp":"^3.0.0","react":"^16.8.6","react-dom":"^16.8.6","react-router-dom":"^5.0.0","react-scripts":"^3.3.0","typescript":"^3.4.5"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm run build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^2.0.1"}}')},51:function(e,t,n){e.exports=n(90)},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},84:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){},88:function(e,t,n){},89:function(e,t,n){},90:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(43),i=n.n(o),c=(n(56),n(1)),u=n(2),s=n(5),l=n(4),p=(n(57),n(6)),d=n(14),m=(n(58),"".concat("/kontent-sample-app-preview-react")),g="".concat("/","callback"),f="".concat("/",":projectId(").concat("[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}",")"),v="".concat(f,"/products"),h="".concat(v,"/:productUrlSlug"),b=n(44);function y(e,t){return Object(b.compile)(e)(t)}var j,w,P=n(19),S=n(12),E=n(3),I=n.n(E),O=n(13),k=n(28);!function(e){e.NotLoaded="notLoaded",e.InProgress="inProgress",e.Finished="finished",e.Failed="failed"}(j||(j={})),function(e){e.Stopped="Stopped",e.Fetching="Fetching",e.Waiting="Waiting"}(w||(w={}));var A,L=n(31),_=n(29),x=null,K=function(e,t){x||(x=Object(L.b)({previewApiKey:t,projectId:e,proxy:{basePreviewUrl:"https://preview-deliver.kontent.ai"},defaultQueryConfig:{usePreviewMode:!0},globalHeaders:function(e){return[{header:"X-KC-SOURCE",value:"".concat(_.name,";").concat(_.version)}]},propertyNameResolver:L.a}))},U=function(e,t){if(K(e,t),!x)throw new Error("Delivery client is not initialized yet");return x.items().type("article_example_content_type").toPromise().then((function(e){return e.data.items})).catch((function(e){return console.log(e),new Array}))},C=function(e,t){if(K(e,t),!x)throw new Error("Delivery client is not initialized yet");return x.items().type("landing_page_example_content_type").toPromise().then((function(e){return e.data.items})).catch((function(e){return console.log(e),new Array}))},F=function(e,t,n){if(K(e,t),!x)throw new Error("Delivery client is not initialized yet");return x.items().type("product_example_content_type").equalsFilter("elements.url",n).toPromise().then((function(e){return e.data.items[0]})).catch((function(e){console.log(e)}))},N={dataLoadingStatus:j.NotLoaded,dataPollingStatus:w.Stopped,previewApiKey:"",previewApiKeyLoadingStatus:j.NotLoaded,projectId:"",projectIdLoadingStatus:j.NotLoaded,articles:new Array,productsByUrlSlug:{},loadWelcomePage:function(){},loadProduct:function(){},loadProducts:function(){},getProducts:function(){return[]},setProjectId:function(){},setLoadingStatus:function(){},setProjectIdLoadingStatus:function(){},setPreviewApiKey:function(){},setPreviewApiKeyLoadingStatus:function(){}},T=r.a.createContext(N),D=T.Provider,W=T.Consumer,M=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={dataLoadingStatus:j.NotLoaded,dataPollingStatus:w.Stopped,previewApiKey:"",previewApiKeyLoadingStatus:j.NotLoaded,projectId:"",projectIdLoadingStatus:j.NotLoaded,articles:new Array,productsByUrlSlug:{}},e._dataPollingInterval=null,e._startDataPolling=function(t){null!==e._dataPollingInterval&&Object(k.clearInterval)(e._dataPollingInterval),e._dataPollingInterval=Object(k.setInterval)(Object(O.a)(I.a.mark((function n(){return I.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.setState({dataPollingStatus:w.Fetching}),n.next=3,t();case 3:e.setState({dataPollingStatus:w.Waiting});case 4:case"end":return n.stop()}}),n)}))),3e3),e.setState({dataPollingStatus:w.Waiting})},e.setProjectId=function(t){e.setState({projectId:t})},e.setLoadingStatus=function(t){e.setState({dataLoadingStatus:t})},e.setProjectIdLoadingStatus=function(t){e.setState({projectIdLoadingStatus:t})},e.setPreviewApiKey=function(t){e.setState({previewApiKey:t})},e.setPreviewApiKeyLoadingStatus=function(t){e.setState({previewApiKeyLoadingStatus:t})},e._loadWelcomePageData=Object(O.a)(I.a.mark((function t(){var n;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U(e.state.projectId,e.state.previewApiKey);case 2:n=t.sent,e.setState({articles:n});case 4:case"end":return t.stop()}}),t)}))),e.loadWelcomePage=Object(O.a)(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._startDataPolling(e._loadWelcomePageData),t.next=3,e._loadWelcomePageData();case 3:case"end":return t.stop()}}),t)}))),e._loadProductsData=Object(O.a)(I.a.mark((function t(){var n,a;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C(e.state.projectId,e.state.previewApiKey);case 2:(n=t.sent)&&n[0]&&(a=n[0].elements.productList.linkedItems,e.setState((function(e){return{productsByUrlSlug:a.reduce((function(e,t){return Object(S.a)(Object(S.a)({},e),{},Object(P.a)({},t.elements.url.value,t))}),Object.assign({},e.productsByUrlSlug))}})));case 4:case"end":return t.stop()}}),t)}))),e.loadProducts=Object(O.a)(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._startDataPolling(e._loadProductsData),t.next=3,e._loadProductsData();case 3:case"end":return t.stop()}}),t)}))),e._loadProductData=function(){var t=Object(O.a)(I.a.mark((function t(n){var a;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F(e.state.projectId,e.state.previewApiKey,n);case 2:(a=t.sent)&&e.setState((function(e){return{productsByUrlSlug:Object(S.a)(Object(S.a)({},Object.assign({},e.productsByUrlSlug)),{},Object(P.a)({},a.elements.url.value,a))}}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.loadProduct=function(){var t=Object(O.a)(I.a.mark((function t(n){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._startDataPolling((function(){return e._loadProductData(n)})),t.next=3,e._loadProductData(n);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.getProducts=function(){return Object.values(e.state.productsByUrlSlug)},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.state,t=e.productsByUrlSlug,n=e.articles,a=e.projectId,o=e.dataLoadingStatus,i=e.dataPollingStatus,c=e.projectIdLoadingStatus,u={dataLoadingStatus:o,dataPollingStatus:i,previewApiKey:e.previewApiKey,previewApiKeyLoadingStatus:e.previewApiKeyLoadingStatus,projectId:a,projectIdLoadingStatus:c,articles:n,productsByUrlSlug:t,loadWelcomePage:this.loadWelcomePage,loadProduct:this.loadProduct,loadProducts:this.loadProducts,getProducts:this.getProducts,setProjectId:this.setProjectId,setLoadingStatus:this.setLoadingStatus,setProjectIdLoadingStatus:this.setProjectIdLoadingStatus,setPreviewApiKey:this.setPreviewApiKey,setPreviewApiKeyLoadingStatus:this.setPreviewApiKeyLoadingStatus};return r.a.createElement(D,{value:u},this.props.children)}}]),n}(r.a.PureComponent),B=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return r.a.createElement(W,null,(function(e){return r.a.createElement("div",{className:"navigation-bar"},r.a.createElement("nav",{className:"navigation-bar__app-menu"},r.a.createElement(d.c,{activeClassName:"navigation-bar__app-menu-button--active",className:"navigation-bar__app-menu-button",exact:!0,to:y(f,{projectId:e.projectId})},"Welcome"),r.a.createElement(d.c,{activeClassName:"navigation-bar__app-menu-button--active",className:"navigation-bar__app-menu-button",to:y(v,{projectId:e.projectId})},"Products")))}))}}]),n}(r.a.PureComponent),H=(n(84),n(85),n(86),function(e){var t=e.title,n=e.children;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"app-title"},t),r.a.createElement("div",{className:"app-content"},n))}),R=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.props.init()}},{key:"render",value:function(){var e=this.props.product;if(e){var t=e.elements.image.value[0]?e.elements.image.value[0].url:"";return r.a.createElement(H,{title:e.elements.name.value},t&&r.a.createElement("img",{className:"product-details__image",alt:e.elements.name.value,src:e.elements.image.value[0]?e.elements.image.value[0].url:""}),r.a.createElement("div",{className:"product-details__description",dangerouslySetInnerHTML:{__html:e.elements.description.value}}))}return r.a.createElement("p",null,"There's no such product")}}]),n}(r.a.PureComponent),q=function(e){var t=e.match;return r.a.createElement(W,null,(function(e){return r.a.createElement(R,{product:e.productsByUrlSlug[t.params.productUrlSlug],init:function(){return e.loadProduct(t.params.productUrlSlug)}})}))},z=(n(87),n(88),"".concat("https://kentico.github.io").concat("/kontent-sample-app-preview-react","/placeholder-images.png")),J=function(e){var t=e.imageSource,n=e.title;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"product-card__thumbnail-wrapper"},r.a.createElement("img",{className:"product-card__thumbnail",src:t,alt:"product thumbnail"})),n||"Untitled content item")},G=function(e){var t=e.projectId,n=e.productId,a=e.pictureUrl,o=e.title,i=a||z;return r.a.createElement("div",{className:"product-card"},n?r.a.createElement(d.b,{to:y(h,{projectId:t,productUrlSlug:n})},r.a.createElement(J,{imageSource:i,title:o})):r.a.createElement(J,{imageSource:i,title:o}))},Q=n(48),X=n.n(Q),Y=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.props.init()}},{key:"render",value:function(){var e=this.props,t=e.projectId,n=e.products,a=1===n.length;return r.a.createElement(H,{title:"Products"},r.a.createElement("div",{className:X()("products-page",{"products-page--has-single-product":a})},n&&n.map((function(e){return r.a.createElement(G,{title:e.elements.name.value,pictureUrl:e.elements.image.value[0]?e.elements.image.value[0].url:"",productId:e.elements.url.value,projectId:t,key:e.system.id})}))))}}]),n}(r.a.PureComponent),Z=function(){return r.a.createElement(W,null,(function(e){return r.a.createElement(Y,{init:e.loadProducts,projectId:e.projectId,products:e.getProducts()})}))},V=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.props.init()}},{key:"render",value:function(){var e=this.props.article;return e?r.a.createElement(H,{title:e.elements.title.value},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.elements.body.value}})):r.a.createElement("p",null,"Missing data for Welcome page")}}]),n}(r.a.PureComponent),$=function(){return r.a.createElement(W,null,(function(e){return r.a.createElement(V,{article:e.articles[0],init:e.loadWelcomePage})}))},ee=n(50),te=(n(89),function(){var e=Object(a.useContext)(T),t=Object(a.useState)(!1),n=Object(ee.a)(t,2),o=n[0],i=n[1];return Object(a.useEffect)((function(){var t=0;return e.dataPollingStatus===w.Fetching?i(!0):o&&(t=window.setTimeout((function(){i(!1)}),1e3)),function(){t&&clearTimeout(t)}}),[e.dataPollingStatus,o]),o?r.a.createElement("div",{className:"progress-bar"}):null}),ne=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return r.a.createElement("div",{className:"app"},r.a.createElement(te,null),r.a.createElement(p.b,{path:f,component:B}),r.a.createElement("div",{className:"app__content-wrapper"},r.a.createElement(p.d,null,r.a.createElement(p.b,{path:f,exact:!0,component:$}),r.a.createElement(p.b,{path:h,component:q}),r.a.createElement(p.b,{path:v,component:Z}),r.a.createElement(p.b,{render:function(){return r.a.createElement("p",null,"Ooops, missing page!")}}))))}}]),n}(r.a.PureComponent),ae=n(49),re={domain:"login.kontent.ai",clientID:"kk5POR5ME2uYwFQWovQ32n61Z5MwDWAH",audience:"https://app.kenticocloud.com/",redirectUri:"https://kentico.github.io/kontent-sample-app-preview-react/callback",responseType:"token id_token",scope:"openid"},oe={returnTo:"https://kentico.github.io/kontent-sample-app-preview-react/logout"},ie=Object(u.a)((function e(){var t=this;Object(c.a)(this,e),this.webAuth=new ae.a.WebAuth(re),this.login=function(){t.webAuth.authorize()},this.silentLogin=function(){localStorage.setItem("redirectUri",window.location.pathname),t.webAuth.authorize({prompt:"none"})},this.logout=function(){t.webAuth.logout(oe)},this.getRedirectUri=function(){var e=localStorage.getItem("redirectUri");localStorage.removeItem("redirectUri");var t=e||"/";return t.startsWith(m)?t.slice(m.length+1):t},this.handleAuthentication=function(e,n){t.webAuth.parseHash((function(a,r){if(r&&r.accessToken&&r.idToken){var o={accessToken:r.accessToken,expiresAt:1e3*(r.expiresIn||0)+(new Date).getTime()},i=t.getRedirectUri();e(o,i)}else a&&(n(),t.login())}))},this.isAuthenticated=function(e){return(new Date).getTime()<e}})),ce=function(){return r.a.createElement("div",null,r.a.createElement("h1",null,"Loading..."))},ue={accessToken:"",expiresAt:0,isLoggedIn:!1,logout:function(){}},se=r.a.createContext(ue),le=se.Provider,pe=se.Consumer,de=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).webAuth=new ie,a.isAuthUrlHash=function(e){return/access_token|id_token|error/.test(e)},a.handleAuthCallback=function(e){var t=e.location;a.isAuthUrlHash(t.hash)&&a.webAuth.handleAuthentication(a.onSuccessLogin,a.onFailedLogin)},a.onSuccessLogin=function(e,t){a.setState({accessToken:e.accessToken,expiresAt:e.expiresAt,isLoggedIn:!0}),a.props.history.push(t)},a.onFailedLogin=function(){console.warn("on failed login")},a.state={accessToken:"",isLoggedIn:!1,expiresAt:0},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this.webAuth.silentLogin;this.isAuthUrlHash(window.location.hash)||e()}},{key:"render",value:function(){var e=this,t=Object(S.a)(Object(S.a)({},this.state),{},{logout:this.webAuth.logout}),n=this.state.isLoggedIn;return r.a.createElement(p.d,null,n?r.a.createElement(p.a,{from:g,to:"/"}):r.a.createElement(p.b,{path:g,render:function(t){return e.handleAuthCallback(t),r.a.createElement(ce,null)}}),n&&r.a.createElement(p.b,{render:function(){return r.a.createElement(le,{value:t},e.props.children)}}))}}]),n}(r.a.Component),me=Object(p.g)(de);!function(e){e.MissingProjectId="missingProjectId",e.UnableToGetPreviewApiKey="unableToGetPreviewApiKey"}(A||(A={}));var ge="https://kentico.github.io/kontent-sample-app-preview-react/<your_project_id>",fe=function(){return r.a.createElement("p",null,"Didn't you forget to provide Project Id in the url? E.g. ",r.a.createElement("i",null,ge))},ve=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"There was problem retrieving Preview Api Key."),r.a.createElement("p",null,"Did you provide correct Project Id? E.g. ",r.a.createElement("i",null,ge)))},he=function(e){var t=e.type;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"navigation-bar"},r.a.createElement("nav",{className:"navigation-bar__app-menu"})),r.a.createElement("p",null,"Ooops, there was some error!"),t===A.MissingProjectId&&r.a.createElement(fe,null),t===A.UnableToGetPreviewApiKey&&r.a.createElement(ve,null))};function be(e,t){t&&Object.keys(t).forEach((function(n){var a=t[n];n&&a&&e.setRequestHeader(n,a)}))}function ye(){return new XMLHttpRequest}function je(e){return e.responseText?JSON.parse(e.responseText):null}var we=function(e){function t(t,n,a,r){var o=function(e,t){if(!t)return e;var n,a=t.authToken?(n=t.authToken,{Authorization:"Bearer ".concat(n)}):{};return t.appInstanceId&&(a["X-AppInstanceId"]=t.appInstanceId),Object(S.a)(Object(S.a)({},e),a)}({"Content-type":"application/json"},r),i=a?function(e){if(e&&"object"===typeof e);else if("string"===typeof e)return JSON.stringify(e);return e}(a):null;return e.request(t,n,i,o)}return{post:function(e,n,a){return t("POST",e,n,a).then((r=[200,201],function(e){if(r.indexOf(e.status)>=0)return e;throw e})).then(je);var r}}}(function(){return e=!0,{request:function(t,n,a,r){return new Promise((function(o){var i=ye();i.open(t,n,!0),i.withCredentials=e,be(i,r),i.onreadystatechange=function(){4===i.readyState&&o(i)},i.send(a)}))},requestFile:function(t,n,a,r){return new Promise((function(o){var i=ye();i.open(t,n,!0),i.responseType="blob",i.withCredentials=e,be(i,r),i.onreadystatechange=function(){4===i.readyState&&o(i)},i.send(a)}))},upload:function(e,t,n,a){return new Promise((function(r){var o=ye();o.open("POST",e,!0),be(o,a),o.onreadystatechange=function(){4===o.readyState&&r(o)},o.upload.addEventListener("progress",n),o.send(t)}))}};var e}()),Pe=function(e,t){var n={authToken:e},a="".concat("https://app.kontent.ai","/api/project-management/").concat(t,"/keys/preview-delivery-api-primary");return we.post(a,null,n)},Se=function(e){var t=e.authContext.accessToken,n=e.appContext.projectId;return function(){return e.getPreviewApiKey(t,n).then((function(e){return e.api_key})).catch((function(){return null}))}},Ee=function(){if(window.location){var e=m+f+"*",t=Object(p.f)(window.location.pathname,e);if(t)return t.params.projectId}return console.warn("no projectId in url"),null},Ie=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"componentDidUpdate",value:function(){this.props.loadApplicationData()}},{key:"render",value:function(){var e=this.props.appContext,t=e.projectIdLoadingStatus,n=e.previewApiKeyLoadingStatus,a=e.dataLoadingStatus;return t===j.Failed?r.a.createElement(he,{type:A.MissingProjectId}):n===j.Failed?r.a.createElement(he,{type:A.UnableToGetPreviewApiKey}):a===j.Finished?this.props.children:r.a.createElement(ce,null)}}]),n}(r.a.PureComponent),Oe=Object(p.g)((function(e){return r.a.createElement(W,null,(function(t){return r.a.createElement(pe,null,(function(n){var a,o=(a={appContext:t,getProjectIdFromUrl:Ee,loadPreviewApikey:Se({authContext:n,appContext:t,getPreviewApiKey:Pe})},Object(O.a)(I.a.mark((function e(){var t,n,r,o,i;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.appContext,n=a.loadPreviewApikey,r=a.getProjectIdFromUrl,t.dataLoadingStatus!==j.Finished){e.next=3;break}return e.abrupt("return");case 3:if(t.projectIdLoadingStatus===j.NotLoaded&&((o=r())?(t.setProjectId(o),t.setProjectIdLoadingStatus(j.Finished)):t.setProjectIdLoadingStatus(j.Failed)),t.projectIdLoadingStatus!==j.Finished||t.previewApiKeyLoadingStatus!==j.NotLoaded){e.next=10;break}return t.setPreviewApiKeyLoadingStatus(j.InProgress),e.next=8,n();case 8:(i=e.sent)?(t.setPreviewApiKey(i),t.setPreviewApiKeyLoadingStatus(j.Finished)):t.setPreviewApiKeyLoadingStatus(j.Failed);case 10:[t.previewApiKeyLoadingStatus,t.projectIdLoadingStatus].every((function(e){return e===j.Finished}))&&t.setLoadingStatus(j.Finished);case 12:case"end":return e.stop()}}),e)}))));return r.a.createElement(Ie,Object.assign({loadApplicationData:o,authContext:n,appContext:t},e))}))}))}));i.a.render(r.a.createElement(d.a,{basename:m},r.a.createElement(me,null,r.a.createElement(M,null,r.a.createElement(Oe,null,r.a.createElement(ne,null))))),document.getElementById("root"))}},[[51,1,2]]]);
//# sourceMappingURL=main.03335d2f.chunk.js.map